from fastapi import FastAPI
from pydantic import BaseModel
import sqlite3

app = FastAPI()

# ---- Veritabanı ----
conn = sqlite3.connect("mydb.db")
conn.execute("CREATE TABLE IF NOT EXISTS blocks (id INTEGER PRIMARY KEY, title TEXT, content TEXT)")
conn.commit()
conn.close()

# ---- Veri modeli ----
class Block(BaseModel):
    title: str
    content: str

# ---- API ----

# Tüm blokları getir
@app.get("/blocks")
def get_blocks():
    conn = sqlite3.connect("mydb.db")
    cursor = conn.cursor()
    cursor.execute("SELECT id, title, content FROM blocks")
    rows = cursor.fetchall()
    conn.close()
    return rows   # Basit: list of tuples

# Yeni blok ekle
@app.post("/blocks")
def add_block(block: Block):
    conn = sqlite3.connect("mydb.db")
    cursor = conn.cursor()
    cursor.execute("INSERT INTO blocks (title, content) VALUES (?, ?)", (block.title, block.content))
    conn.commit()
    new_id = cursor.lastrowid
    conn.close()
    return {"id": new_id, "title": block.title, "content": block.content}
